---
import BaseHead from '../../components/BaseHead.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { SITE_TITLE, SITE_DESCRIPTION } from '../../consts';
import { getCollection } from 'astro:content';
import FormattedDate from '../../components/FormattedDate.astro';

// Get all blog posts
const allPosts = await getCollection('blog');

// Separate active and archived posts
const activePosts = allPosts.filter(post => post.data.category !== 'archived');
const archivedPosts = allPosts.filter(post => post.data.category === 'archived');

// Sort active posts in descending order of publication date
const sortedActivePosts = activePosts.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

// Sort archived posts in descending order of publication date
const sortedArchivedPosts = archivedPosts.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
  </head>
  <body>
    <Header />
    <main class="layout-blog">
      <h1>Blog</h1>
      <section>
        <h2>All Posts</h2>
        <ul>
          {sortedActivePosts.map((post) => (
            <li>
              <a href={`/blog/${post.slug}/`}>
                <h4 class="title">{post.data.title}</h4>
                <FormattedDate date={post.data.pubDate} />
              </a>
            </li>
          ))}
        </ul>
      </section>
      <section>
        <h2>Archived Posts</h2>
        <ul>
          {sortedArchivedPosts.map((post) => (
            <li>
              <a href={`/blog/${post.slug}/`}>
                <h4 class="title">{post.data.title}</h4>
                <FormattedDate date={post.data.pubDate} />
              </a>
            </li>
          ))}
        </ul>
      </section>
    </main>
    <Footer />
  </body>
</html>

<style lang="scss">
.layout-blog{
  margin-top: 4rem;

  h1{
    font-size: 2rem;
    line-height: 2.5rem;
  }
}
</style>
